I"<h1 id="threading-programmer-guide2">Threading Programmer Guide（2）</h1>

<h2 id="线程管理">线程管理</h2>

<p>OS X或iOS中的每个进程（应用程序）由一个或多个线程组成，每个线程代表通过应用程序代码执行的单个路径。每个应用程序都从一个线程开始，该线程运行该应用程序的<code class="language-plaintext highlighter-rouge">main</code>功能。应用程序可以产生其他线程，每个线程都执行特定功能的代码。</p>

<p>当应用程序产生新线程时，该线程将成为应用程序进程空间内的一个独立实体。每个线程都有其自己的执行堆栈，并由内核分别计划在运行时运行。线程可以与其他线程和其他进程通信，执行I / O操作以及执行您可能需要执行的其他任何操作。但是，由于它们位于同一进程空间内，因此单个应用程序中的所有线程共享同一虚拟内存空间，并且与进程本身具有相同的访问权限。</p>

<h3 id="线程成本">线程成本</h3>

<p>就内存使用和性能而言，线程化对您的程序（和系统）造成了实际损失。每个线程都需要在内核内存空间和程序的内存空间中分配内存。使用有线内存将管理线程和协调其调度所需的核心结构存储在内核中。线程的堆栈空间和每个线程的数据存储在程序的内存空间中。这些结构中的大多数是在您首次创建线程时创建和初始化的，由于与内核之间的交互作用，该过程可能相对昂贵。</p>

<p><img src="/img/typora-user-images/截屏2020-09-10 下午2.01.41.png" alt="" /></p>

<p><strong>注意：</strong> 由于具有底层内核支持，因此操作对象通常可以更快地创建线程。他们不是每次都从头开始创建线程，而是使用已经驻留在内核中的线程池来节省分配时间。</p>

<p>编写线程代码时要考虑的另一个成本是生产成本。设计线程化的应用程序有时可能需要对组织应用程序的数据结构的方式进行根本性的更改。为避免使用同步，可能需要进行这些更改，否则同步本身可能对设计不良的应用程序造成巨大的性能损失。设计这些数据结构以及调试线程代码中的问题可能会增加开发线程应用程序所需的时间。但是，如果线程花费太多时间等待锁或不执行任何操作，则避免这些开销会在运行时产生更大的问题。</p>

<h3 id="创建一个线程">创建一个线程</h3>

<p>创建低级线程相对简单。在所有情况下，您都必须具有一个函数或方法作为线程的主要入口点，并且必须使用可用的线程例程之一来启动线程。以下各节显示了更常用的线程技术的基本创建过程。使用这些技术创建的线程将继承一组默认属性，这些属性由您使用的技术确定。</p>

<h4 id="使用nsthread">使用NSThread</h4>

<h4 id="使用posi线程">使用POSI线程</h4>

<h4 id="使用nsobject生成线程">使用NSObject生成线程</h4>

<h4 id="在cocoa应用程序中使用posix线程">在Cocoa应用程序中使用POSIX线程</h4>

<h5 id="保护可可框架">保护可可框架</h5>

<h5 id="混合posix和可可锁">混合POSIX和可可锁</h5>

<h3 id="配置线程属性">配置线程属性</h3>

<p>在创建线程之后，有时甚至在创建线程之前，您可能需要配置线程环境的不同部分</p>

<h4 id="配置线程的堆栈大小">配置线程的堆栈大小</h4>

<h4 id="配置线程本地存储">配置线程本地存储</h4>

<h4 id="设置线程的分离状态">设置线程的分离状态</h4>

<h4 id="设置线程的优先级">设置线程的优先级</h4>

<h3 id="编写线程输入例程">编写线程输入例程</h3>

<h4 id="创建一个自动释放池">创建一个自动释放池</h4>

<h4 id="设置异常处理程序">设置异常处理程序</h4>

<h4 id="设置运行循环">设置运行循环</h4>

<h3 id="终止线程">终止线程</h3>
:ET